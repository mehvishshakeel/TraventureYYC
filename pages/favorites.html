<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
  <title>Favorites - TraventureYYC</title>
  <link rel="stylesheet" href="../css/main.css">

</head>
<body>
  <div class="app-container">

    <!-- Status Bar -->
    <div class="status-bar">
      <div class="status-bar__left"><div class="status-bar__time">9:41</div></div>
      <div class="status-bar__right">
        <div class="status-bar__signal"><img src="../images/mobile-signal-60.svg"></div>
        <div class="status-bar__wifi"><img src="../images/wifi-59.svg"></div>
        <div class="status-bar__battery">
          <img src="../images/combined-shape-57.svg">
          <img src="../images/rectangle-58.svg">
        </div>
      </div>
    </div>

    <!-- Top Bar -->
    <div class="top-bar">
      <a href="homepage.html" style="color: var(--color-text-black); font-size: x-large;">←</a>
      <div class="top-bar__logo">
        Traventure<span class="top-bar__logo-accent">YYC</span>
      </div>
      <div class="top-bar__actions">
        <a href="signup.html" style="color: var(--color-primary); font-size: 14px; margin-right: var(--spacing-sm);">Sign up</a>
      </div>
    </div>

    <!-- Unsave Confirmation Modal -->
    <div id="unsaveModal" class="call-modal-overlay">
      <div class="call-modal">
        <h2>Remove Favorite?</h2>
        <p>Unsave this event?</p>
        <div class="modal-btn-row">
          <button id="unsaveYesBtn" class="modal-confirm-btn">Yes</button>
          <button id="unsaveNoBtn" class="modal-cancel-btn">Cancel</button>
        </div>
      </div>
    </div>

    <script>
      let pendingRemoveId = null;

      function showUnsaveModal(id) {
        pendingRemoveId = id;
        document.getElementById("unsaveModal").style.display = "flex";
      }

      document.getElementById("unsaveYesBtn").onclick = function () {
        let favs = loadFavorites().filter(f => f.id !== pendingRemoveId);
        saveFavorites(favs);
        document.getElementById("unsaveModal").style.display = "none";
        loadFavoritesList();
      };

      document.getElementById("unsaveNoBtn").onclick = function () {
        document.getElementById("unsaveModal").style.display = "none";
      };
    </script>

    <script>
      function loadFavorites() {
        return JSON.parse(localStorage.getItem("favorites") || "[]");
      }
      function saveFavorites(list) {
        localStorage.setItem("favorites", JSON.stringify(list));
      }
    </script>

    <div class="content">
      <h1 style="font-size: 24px; font-weight: 700; margin-bottom: var(--spacing-md);">Favorites</h1>

      <!-- Tabs -->
      <div class="tabs">
        <div class="tab" onclick="switchTab('restaurants')">Restaurants</div>
        <div class="tab active" onclick="switchTab('events')">Events</div>
        <div class="tab" onclick="switchTab('activities')">Activities</div>
      </div>

      <!-- EVENTS TAB -->
      <div id="eventsTab">
        <div id="favoriteEventsContainer"></div>
      </div>

      <div id="restaurantsTab" class="tab-content" style="display:none;"></div>
      
      <!-- ACTIVITES TAB -->
      
      <div id="activitiesTab" class="tab-content" style="display:none;">
        <div id="favoriteActivitiesContainer"></div>
      </div>

    </div>

    <!-- Bottom Navigation -->
    <div class="bottom-nav">
      <a href="itinerary.html" class="bottom-nav__item">
        <img src="../images/calendar-39.svg" class="bottom-nav__icon">
        <span class="bottom-nav__label">Itinerary</span>
      </a>
      <a href="homepage.html" class="bottom-nav__item">
        <img src="../images/home-42.svg" alt="Home" class="bottom-nav__icon">
        <span class="bottom-nav__label">Home</span>
      </a>
      <a href="emergency.html" class="bottom-nav__item">
        <img src="../images/icon-emergency-44.png" class="bottom-nav__icon">
        <span class="bottom-nav__label">Emergency</span>
      </a>
      <a href="settings.html" class="bottom-nav__item">
        <img src="../images/node-46.png" class="bottom-nav__icon">
        <span class="bottom-nav__label">Settings</span>
      </a>
    </div>
  </div>

  <script>
    function loadFavoritesList() {
      const container = document.getElementById("favoriteEventsContainer");
      container.innerHTML = "";

      const favs = loadFavorites().filter(f => f.type === "event");

      if (favs.length === 0) {
        container.innerHTML = `<p style="color:#777; text-align:center; margin-top:20px;">No favorite events yet.</p>`;
        return;
      }

      favs.forEach(f => {
        const div = document.createElement("div");
        div.className = "list-item";
        div.dataset.id = f.id;

        div.innerHTML = `
          <img src="${f.image}" class="list-item__image">
          <div class="list-item__content">
            <div class="list-item__title">${f.title}</div>
            <div class="list-item__subtitle">${f.subtitle || ""}</div>
          </div>
          <div class="list-item__actions">
            <button class="event-fav-btn icon-button is-active">♥</button>
            <span class="add-to-itinerary-btn" style="font-size: 20px;">+</span>
          </div>
        `;

        // remove fav
        div.querySelector(".event-fav-btn").onclick = function (e) {
          e.stopPropagation();
          showUnsaveModal(f.id);
        };

        // add to itinerary
        div.querySelector(".add-to-itinerary-btn").onclick = function (e) {
          e.stopPropagation();

          const pending = {
            title: f.title,
            subtitle: f.subtitle || "",
            image: f.image || "",
            eventId: f.id,
            date: new Date().toISOString().slice(0, 10),
            startTime: "13:00",
            endTime: "14:00",
            location: ""
          };

          sessionStorage.setItem("pendingItineraryData", JSON.stringify(pending));
          window.location.href = "itinerary-edit.html";
        };


        // open event details
        div.onclick = function () {
          sessionStorage.setItem("cameFromFavorites", "yes");
          window.location.href = "events.html?id=" + f.id;
        };

        container.appendChild(div);
      });
    }

    document.addEventListener("DOMContentLoaded", () => {
      loadFavoritesList();        // events
      renderFavoriteActivities(); // activities
    });

  </script>

  <script>
    function loadFavoriteActivities() {
      return loadFavorites().filter(f => f.type === "activity");
    }

    function renderFavoriteActivities() {
      const container = document.getElementById("favoriteActivitiesContainer");
      container.innerHTML = "";

      const favs = loadFavoriteActivities();

      if (favs.length === 0) {
        container.innerHTML = `<p style="color:#777; text-align:center; margin-top:20px;">
          No favorite activities yet.
        </p>`;
        return;
      }

      favs.forEach(f => {
        const div = document.createElement("div");
        div.className = "list-item";
        div.dataset.id = f.id;

        div.innerHTML = `
          <img src="${f.image}" class="list-item__image">
          <div class="list-item__content">
            <div class="list-item__title">${f.title}</div>
            <div class="list-item__subtitle">${f.subtitle || ""}</div>
          </div>
          <div class="list-item__actions">
            <button class="event-fav-btn icon-button is-active">♥</button>
            <span class="add-to-itinerary-btn" style="font-size:20px;">+</span>
          </div>
        `;

        // HEART REMOVE
        div.querySelector(".event-fav-btn").onclick = (e) => {
          e.stopPropagation();

          openUnsaveModal(f.id, () => {
            let favs = loadFavorites().filter(item => item.id !== f.id);
            saveFavorites(favs);
            renderFavoriteActivities();
          });
        };

        // ADD TO ITINERARY
        div.querySelector(".add-to-itinerary-btn").onclick = (e) => {
          e.stopPropagation();

          const pending = {
            title: f.title,
            subtitle: f.subtitle || "",
            image: f.image || "",
            eventId: f.id,
            date: new Date().toISOString().slice(0, 10),
            startTime: "13:00",
            endTime: "14:00",
            location: ""
          };

          sessionStorage.setItem("pendingItineraryData", JSON.stringify(pending));
          window.location.href = "itinerary-edit.html";
        };

        // OPEN DETAILS PAGE
        div.onclick = () => {
          sessionStorage.setItem("cameFromFavorites", "yes");
          window.location.href = "attractions.html?id=" + f.id;
        };

        container.appendChild(div);
      });
    }
    </script>


<script>
  function switchTab(tab) {
    // Hide all tabs
    document.getElementById('eventsTab').style.display = 'none';
    document.getElementById('restaurantsTab').style.display = 'none';
    document.getElementById('activitiesTab').style.display = 'none';

    // Remove active class from all tabs
    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));

    // Show selected tab
    if (tab === 'events') {
      document.getElementById('eventsTab').style.display = 'block';
      document.querySelectorAll('.tab')[1].classList.add('active');
    } else if (tab === 'restaurants') {
      document.getElementById('restaurantsTab').style.display = 'block';
      document.querySelectorAll('.tab')[0].classList.add('active');
    } else if (tab === 'activities') {
      document.getElementById('activitiesTab').style.display = 'block';
      document.querySelectorAll('.tab')[2].classList.add('active');
    }
  }

  // ================================
  // FAVORITE RESTAURANTS RENDERING
  // ================================

  function getFavoriteRestaurants() {
    const key = "favoriteRestaurants";
    try {
      const raw = localStorage.getItem(key);
      if (!raw) return [];
      const parsed = JSON.parse(raw);
      return Array.isArray(parsed) ? parsed : [];
    } catch (e) {
      console.error("Failed to parse favoriteRestaurants from localStorage:", e);
      return [];
    }
  }

  function saveFavoriteRestaurants(list) {
    localStorage.setItem("favoriteRestaurants", JSON.stringify(list));
  }

  function removeFavoriteRestaurantByName(name) {
    const current = getFavoriteRestaurants();
    const updated = current.filter(r => r.name !== name);
    saveFavoriteRestaurants(updated);
  }

  function renderFavoriteRestaurants() {
    const listContainer = document.getElementById("restaurantsList");
    const emptyMsg = document.getElementById("noRestaurantsMessage");

    if (!listContainer || !emptyMsg) return;

    const favorites = getFavoriteRestaurants();
    listContainer.innerHTML = "";

    if (!favorites.length) {
      emptyMsg.style.display = "block";
      return;
    }

    emptyMsg.style.display = "none";

    favorites.forEach(place => {
      const item = document.createElement("div");
      item.className = "list-item";

      const imageSrc = place.image || "../images/foods-image-18.png";
      const rating = place.rating || "—";
      const time = place.estimated_time || "";

      item.innerHTML = `
        <img src="${imageSrc}" alt="${place.name || "Restaurant"}" class="list-item__image">
        <div class="list-item__content">
          <div class="list-item__title">${place.name || "Unnamed place"}</div>
          <div class="list-item__subtitle">
            <div class="rating">
              <span class="rating__value">${rating}</span>
            </div>
            ${time ? `<div>${time}</div>` : ""}
          </div>
        </div>
        <div class="list-item__actions">
          <!-- Heart = remove from favourites -->
          <span class="list-item__icon fav-heart" style="font-size: 20px; cursor: pointer;">❤️</span>
        </div>
      `;

      const heart = item.querySelector(".fav-heart");
      heart.addEventListener("click", () => {
        removeFavoriteRestaurantByName(place.name);
        renderFavoriteRestaurants();
      });

      listContainer.appendChild(item);
    });
  }

  document.addEventListener("DOMContentLoaded", () => {
    // Initial render of restaurants favorites
    renderFavoriteRestaurants();

    // Default visible tab is Events (matches your current HTML)
    switchTab('events');
  });
</script>
<script src="../js/app.js"></script>
</body>
</html>