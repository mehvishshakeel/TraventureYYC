<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
  <title>Food - TraventureYYC</title>

  <!-- Global styles -->
  <link rel="stylesheet" href="../css/main.css">
  <!-- Page-specific styles -->
  <link rel="stylesheet" href="../css/food-page.css">
</head>

<body class="food-page">
  <div class="app-container">
    <!-- Status Bar -->
    <div class="status-bar">
      <div class="status-bar__left">
        <div class="status-bar__time">9:41</div>
      </div>
      <div class="status-bar__right">
        <div class="status-bar__signal">
          <img src="../images/mobile-signal-60.svg" alt="Signal">
        </div>
        <div class="status-bar__wifi">
          <img src="../images/wifi-59.svg" alt="WiFi">
        </div>
        <div class="status-bar__battery">
          <img src="../images/combined-shape-57.svg" alt="Battery">
          <img src="../images/rectangle-58.svg" alt="Battery">
        </div>
      </div>
    </div>

    <!-- Top Bar -->
    <div class="top-bar">
      <a href="homepage.html" style="color: var(--color-text-black); font-size: x-large;">‚Üê</a>
      <div class="top-bar__logo">
        Traventure<span class="top-bar__logo-accent">YYC</span>
      </div>
      <div class="top-bar__actions">
        <a href="signup.html"
           style="color: var(--color-primary); font-size: 14px; margin-right: var(--spacing-sm);">Sign up</a>
        <div class="language-selector">
          <button class="lang-btn">
            <span class="lang-text">ENG</span>
            <img src="../images/english-51.png" alt="English" class="flag-icon">
          </button>
          <div class="lang-menu">
            <div class="lang-option" data-lang="en">English</div>
            <div class="lang-option" data-lang="fr">Fran√ßais</div>
            <div class="lang-option" data-lang="es">Espa√±ol</div>
            <div class="lang-option" data-lang="ch">‰∏≠Êñá</div>
            <div class="lang-option" data-lang="jp">Êó•Êú¨Ë™û</div>
          </div>
        </div>
      </div>
    </div>

    <!-- Language modal -->
    <div id="langModal" class="call-modal-overlay" style="display:none;">
      <div class="call-modal">
        <h2>Language Feature</h2>
        <p>This feature is currently in development.</p>

        <button class="modal-cancel-btn" onclick="closeLangModal()">Close</button>
      </div>
    </div>

    <!-- Content (scrollable middle) -->
    <div class="content">
      <div class="food-header">
        <h1 class="food-header__title">Let's Eat!</h1>
      </div>

      <!-- Category Filters -->
      <div class="food-category-filters">
        <div class="food-category-filter active">All</div>
             <div class="food-category-filter">Fast Foods</div>
        <div class="food-category-filter">Indian</div>
        <div class="food-category-filter">Halal</div>
        <div class="food-category-filter">Dessert</div>
      </div>

      <!-- Search Bar -->
      <div class="search-bar">
        <span>üîç</span>
        <input
          type="text"
          class="search-bar__input"
          id="foodSearchInput"
          placeholder="What are you craving today?"
        >
      </div>

      <!-- Popular Section -->
      <div class="popular-section">
        <h2 class="section-title">Popular Near You</h2>
        <div id="popular-list"></div>
      </div>
    </div>

    <!-- 75% HEIGHT PLACE POPUP (bottom sheet) - now INSIDE app-container -->
    <div id="placePopup" class="place-popup-overlay">
      <div class="place-popup-panel" onclick="event.stopPropagation()">
        <div class="popup-drag"></div>
        <button id="popupCloseBtn" class="popup-close-btn">√ó</button>

        <div class="popup-header">
          <div class="popup-header-main">
            <div class="popup-header-text">
              <div id="popupName" class="popup-title"></div>
              <div class="popup-sub">
                <span id="popupRating"></span>
                <span id="popupPhone"></span>
              </div>
            </div>

            <div class="popup-header-actions">
              <a
                id="popupMapBtn"
                href="#"
                class="list-item__icon-pill popup-icon-pill popup-map-link"
                aria-label="Open map"
              ><img src="../images/Directions_Icon.png" class="embassy-action-icon" alt=""></a>

              <button
                id="popupPhoneBtn"
                class="list-item__icon-pill popup-icon-pill"
                aria-label="Call restaurant"
              ><img src="../images/Call_Icon.png" class="embassy-action-icon" alt=""></button>

              <button
  id="popupAddBtn"
  class="icon-button"
  aria-label="Add to itinerary"
>
  +
</button>

            </div>
          </div>
        </div>

        <div class="popup-scroll">
          <div class="popup-section">
            <div class="popup-section-title">Popular dishes</div>
            <div id="popupDishesList" class="popup-dish-list"></div>
          </div>

          <div class="popup-section">
            <div class="popup-section-title">Customer reviews</div>
            <div id="popupReviewsList" class="popup-review-list"></div>
          </div>
        </div>
      </div>
    </div>

<!-- Bottom Navigation -->
    <div class="bottom-nav">
      <a href="itinerary.html" class="bottom-nav__item">
        <img src="../images/calendar-39.svg" alt="Itinerary" class="bottom-nav__icon">
        <span class="bottom-nav__label">Itinerary</span>
      </a>
      <a href="homepage.html" class="bottom-nav__item">
        <img src="../images/home-42.svg" alt="Home" class="bottom-nav__icon">
        <span class="bottom-nav__label">Home</span>
      </a>
      <a href="emergency.html" class="bottom-nav__item">
        <img src="../images/icon-emergency-44.png" alt="Emergency" class="bottom-nav__icon">
        <span class="bottom-nav__label">Emergency</span>
      </a>
      <a href="settings.html" class="bottom-nav__item">
        <img src="../images/node-46.png" alt="Settings" class="bottom-nav__icon">
        <span class="bottom-nav__label">Settings</span>
      </a>
    </div>
  </div>

    
    <!-- ============================
     FOOD PAGE CALL MODAL
=============================== -->
<div id="foodCallModal" class="call-modal-overlay" style="display:none;">
  <div class="call-modal">
    <h2 id="foodModalTitle">Call Restaurant</h2>
    <p id="foodModalDescription">Would you like to call this restaurant?</p>

    <div id="foodModalNumberDisplay" class="modal-number-box"></div>

    <button id="foodConfirmCallBtn" class="modal-call-btn">Call</button>
    <button class="modal-cancel-btn" onclick="closeFoodCallModal()">Cancel</button>
  </div>
</div>
<!-- ============================
     FOOD PAGE - FAVORITE ALREADY ADDED MODAL
=============================== -->
<div id="foodFavoriteModal" class="call-modal-overlay" style="display:none;">
  <div class="call-modal">
    <h2 id="foodFavoriteTitle">Already in Favorites</h2>
    <p id="foodFavoriteDescription">
      This place is already in your favorites list.
    </p>

    <button class="modal-cancel-btn" onclick="closeFoodFavoriteModal()">Close</button>
  </div>
</div>

<!-- UNIVERSAL UNSAVE MODAL (same as Events/Activities) -->
<div id="unsaveModal" class="call-modal-overlay" style="display:none;">
  <div class="call-modal">
    <h2>Remove Favorite?</h2>
    <p>Unsave this place?</p>
    <div class="modal-btn-row">
      <button id="unsaveYesBtn" class="modal-confirm-btn">Yes</button>
      <button id="unsaveNoBtn" class="modal-cancel-btn">Cancel</button>
    </div>
  </div>
</div>


<!-- ============================
     FOOD PAGE - ADD TO ITINERARY MODAL
     (same style as call modal)
=============================== -->
<div id="foodItineraryModal" class="call-modal-overlay" style="display:none;">
  <div class="call-modal">
    <h2 id="foodItineraryTitle">Add to Itinerary</h2>
    <p id="foodItineraryDescription">
      Choose a date, time, and optional details for this restaurant.
    </p>

    <div class="modal-number-box" style="text-align:left;">
      <div style="margin-bottom:8px;">
        <label for="foodItineraryDate"><strong>Date</strong></label><br>
        <input
          type="date"
          id="foodItineraryDate"
          style="width:100%; margin-top:4px; padding:6px; border-radius:8px; border:1px solid #ccc;"
        >
      </div>

      <div style="margin-bottom:8px;">
        <label for="foodItineraryTime"><strong>Time</strong> (optional)</label><br>
        <input
          type="time"
          id="foodItineraryTime"
          style="width:100%; margin-top:4px; padding:6px; border-radius:8px; border:1px solid #ccc;"
        >
      </div>

      <div>
        <label for="foodItineraryDetails"><strong>Details</strong> (optional)</label><br>
        <input
          type="text"
          id="foodItineraryDetails"
          placeholder="e.g., Dinner, 18:00 - 19:30"
          style="width:100%; margin-top:4px; padding:6px; border-radius:8px; border:1px solid #ccc;"
        >
      </div>
    </div>

    <button id="foodConfirmItineraryBtn" class="modal-call-btn">Add to itinerary</button>
    <button class="modal-cancel-btn" onclick="closeFoodItineraryModal()">Cancel</button>
  </div>
</div>

  </div> <!-- end .app-container -->

  <!-- Global JS -->
  <script src="../js/app.js"></script>

  <!-- Page JS -->
  <script>
    const PLACES_JSON_URL  = "../calgary_places.json";
    const DISHES_JSON_URL  = "../dishes.json";
    const REVIEWS_JSON_URL = "../reviews.json";

    const listContainer = document.getElementById("popular-list");
    const searchInput   = document.getElementById("foodSearchInput");

    // Popup elements
    const popupOverlay       = document.getElementById("placePopup");
    const popupCloseBtn      = document.getElementById("popupCloseBtn");
    const popupNameEl        = document.getElementById("popupName");
    const popupRatingEl      = document.getElementById("popupRating");
    const popupPhoneEl       = document.getElementById("popupPhone");
    const popupDishesListEl  = document.getElementById("popupDishesList");
    const popupReviewsListEl = document.getElementById("popupReviewsList");
    const popupMapBtn        = document.getElementById("popupMapBtn");
    const popupPhoneBtn      = document.getElementById("popupPhoneBtn");
    const popupAddBtn        = document.getElementById("popupAddBtn");

    const FOOD_PLACEHOLDER_IMAGE = "../images/foods-image-18.png";

    let allPlaces      = [];
    let dishesByPlace  = {};
    let reviewsByPlace = {};
    let currentCategory = "fastfood";

    function getDishesForPlace(place) {
      if (!place || !place.name) return [];
      return dishesByPlace[place.name] || [];
    }


    function openPlacePopup(place) {
      document.body.classList.add("popup-open");

      popupNameEl.textContent   = place.name || "";
      popupRatingEl.textContent = place.rating || "No rating";
      popupPhoneEl.textContent  = place.phone || "No phone";

      const mapUrl = `map.html?place=${encodeURIComponent(place.name || "")}&return=food`;

      // Map button in header
      popupMapBtn.href = mapUrl;
      popupMapBtn.onclick = (e) => {
        e.stopPropagation();
      };

// Phone button in popup header
popupPhoneBtn.onclick = (e) => {
  e.stopPropagation();

  const rawNumber = place.phone || "";
  if (!rawNumber) return;

  const cleaned = rawNumber.replace(/[^0-9]/g, "");

  openFoodCallModal(
    place.name || "Call Restaurant",
    cleaned,
    "Would you like to call this restaurant?"
  );
};


      // Add-to-itinerary button in header
      popupAddBtn.onclick = (e) => {
        e.stopPropagation();
        handleAddToItinerary(place);
      };

      // Popular dishes
      const dishes = getDishesForPlace(place);
      if (!dishes.length) {
        popupDishesListEl.innerHTML =
          '<p class="popup-empty">No dish information available yet.</p>';
      } else {
        popupDishesListEl.innerHTML = dishes.map(dish => `
          <div class="popup-dish">
            <img
              src="${FOOD_PLACEHOLDER_IMAGE}"
              alt="${dish.name}"
              class="popup-dish__image"
            >
            <div class="popup-dish__info">
              <div class="popup-dish__name">${dish.name}</div>
              <div class="popup-dish__cost">${dish.cost || ""}</div>
              
            </div>
          </div>
        `).join("");
      }

      // Customer reviews
      const reviews = (reviewsByPlace[place.name] || []);
      if (!reviews.length) {
        popupReviewsListEl.innerHTML = '<p class="popup-empty">No reviews yet.</p>';
      } else {
        popupReviewsListEl.innerHTML = reviews.map(r => `
          <div class="popup-review">
            <img
              src="${r.photo || FOOD_PLACEHOLDER_IMAGE}"
              alt="Food"
              class="popup-review__image"
            >
            <div class="popup-review__info">
              <div class="popup-review__name">${r.customer_name}</div>
              <div class="popup-review__date">${r.date}</div>
              <div class="popup-review__text">${r.review}</div>
            </div>
          </div>
        `).join("");
      }

      popupOverlay.classList.add("show");
    }

    function closePlacePopup() {
      popupOverlay.classList.remove("show");
      document.body.classList.remove("popup-open");
    }

    popupOverlay.addEventListener("click", (e) => {
      if (e.target === popupOverlay) {
        closePlacePopup();
      }
    });
    popupCloseBtn.addEventListener("click", closePlacePopup);


    // Add to itinerary (+)
    function handleAddToItinerary(place) {
      openFoodItineraryModal(place);
    }


        /* ---------- SHARED FAVORITES STORAGE (same as Events/Activities) ----------- */
    function loadFavorites() {
      return JSON.parse(localStorage.getItem("favorites") || "[]");
    }
    function saveFavorites(list) {
      localStorage.setItem("favorites", JSON.stringify(list));
    }

    // Reusable heart / favorite button initializer
function initHeartFavoriteButton(buttonElement, baseItem) {
  if (!buttonElement || !baseItem || !baseItem.id) return;

  let favorites = loadFavorites();
  let isFav = favorites.some(f => f.id === baseItem.id);

  // Initial UI
  buttonElement.textContent = isFav ? "‚ô•" : "‚ô°";
  buttonElement.classList.toggle("is-active", isFav);

  buttonElement.addEventListener("click", (e) => {
    e.stopPropagation(); // don't trigger card click

    favorites = loadFavorites();
    const index = favorites.findIndex(f => f.id === baseItem.id);

    // Helper to actually remove
    const doRemove = () => {
      favorites = loadFavorites(); // reload in case it changed
      const idx = favorites.findIndex(f => f.id === baseItem.id);
      if (idx >= 0) {
        favorites.splice(idx, 1);
        saveFavorites(favorites);
      }
      isFav = false;
      buttonElement.textContent = "‚ô°";
      buttonElement.classList.remove("is-active");
    };

    if (index >= 0) {
      // Already a favorite ‚Üí show "Remove Favorite? Unsave this item?"
      if (typeof openUnsaveModal === "function") {
        openUnsaveModal(baseItem.id, doRemove);
      } else {
        // fallback: no modal defined on this page
        doRemove();
      }
    } else {
      // Add to favorites
      favorites.push(baseItem);
      saveFavorites(favorites);
      isFav = true;
      buttonElement.textContent = "‚ô•";
      buttonElement.classList.add("is-active");
    }
  });
}


    /* ----------- Universal unsave modal (same as events/activities) ------------ */
    function openUnsaveModal(id, onConfirm) {
      const modal = document.getElementById("unsaveModal");
      modal.style.display = "flex";

      document.getElementById("unsaveYesBtn").onclick = () => {
        modal.style.display = "none";
        onConfirm();
      };
      document.getElementById("unsaveNoBtn").onclick = () => {
        modal.style.display = "none";
      };
    }

    /* ---------- Add favorite (FOOD becomes type: "restaurant") ---------- */
    function addFoodToFavorites(place) {
      let favs = loadFavorites();
      const exists = favs.some(f => f.id === place.name);

      if (!exists) {
        favs.push({
          id: place.name,
          title: place.name,
          subtitle: place.rating || "",
          image: "../images/foods-image-18.png",
          type: "restaurant"
        });
        saveFavorites(favs);
      }
    }

   /* ---------------- Remove favorite (with modal) ----------------- */
    function removeFoodFavorite(placeName, listHeartEl) {
      openUnsaveModal(placeName, () => {
        let favs = loadFavorites().filter(f => f.id !== placeName);
        saveFavorites(favs);

        // Update UI heart (Food page card)
        if (listHeartEl) {
          listHeartEl.textContent = "‚ô°";
          listHeartEl.classList.remove("is-active");
        }

        // Update popup heart (if open)
        const popupHeart = document.getElementById("popupFavBtn");
        if (popupHeart && popupHeart.dataset.id === placeName) {
          popupHeart.textContent = "‚ô°";
          popupHeart.classList.remove("is-active");
        }

        // Immediately refresh Restaurants tab in Favorites page
        if (typeof loadFavoriteRestaurants === "function") {
          try { loadFavoriteRestaurants(); } catch (e) {}
        }
      });
    }

   // Render list of places into cards
function renderPlaces(places) {
  listContainer.innerHTML = "";

  const favorites = loadFavorites().filter(f => f.type === "restaurant");


  places.forEach(place => {
    const mapUrl = `map.html?place=${encodeURIComponent(place.name)}&return=food`;
    const item = document.createElement("div");
    item.className = "list-item";

    // Check if already favorited
    const isFav = favorites.some(f => f.id === place.name);
const heartHTML = `
  <button class="event-fav-btn icon-button ${isFav ? "is-active" : ""}">
    ${isFav ? "‚ô•" : "‚ô°"}
  </button>
`;



    item.innerHTML = `
      <div class="list-item__image-wrapper">
        <img src="${FOOD_PLACEHOLDER_IMAGE}" class="list-item__image" alt="${place.name}">
        <div class="list-item__favorite">
          ${heartHTML}
        </div>
      </div>
      <div class="list-item__details">
        <div class="list-item__title">${place.name}</div>

        <div class="list-item__bottom-row">
          <div class="list-item__meta-block">
            <div class="list-item__rating">
              <span class="list-item__rating-star">‚òÖ</span>
              <span>${place.rating}</span>
            </div>
            <div class="list-item__time">
              <span>${place.estimated_time}</span>
            </div>
          </div>

          <div class="list-item__actions-inline">
            <a href="${mapUrl}" class="list-item__icon-pill list-item__map-link">
              <img src="../images/Directions_Icon.png" class="embassy-action-icon">
            </a>

            <button class="list-item__phone-link" data-phone="${place.phone || ''}">
              <img src="../images/Call_Icon.png" class="embassy-action-icon">
            </button>

         <button
  class="icon-button list-item__add-link"
  aria-label="Add to itinerary"
>
  +
</button>


          </div>
        </div>
      </div>
    `;
// inside renderPlaces
const heartBtn = item.querySelector(".event-fav-btn");

const baseItem = {
  id: place.name,
  title: place.name,
  subtitle: place.rating || "",
  image: FOOD_PLACEHOLDER_IMAGE,
  type: "restaurant"
};

// hook up the heart behaviour
initHeartFavoriteButton(heartBtn, baseItem);


    // open popup when tapping anywhere on the card
item.addEventListener("click", () => {
  openPlacePopup(place);
});





    // Map button
    const mapLink = item.querySelector(".list-item__map-link");
    mapLink.addEventListener("click", (event) => {
      event.stopPropagation(); // don't open popup
    });

    // Phone button
    const phoneButton = item.querySelector(".list-item__phone-link");
    phoneButton.addEventListener("click", (event) => {
      event.stopPropagation();

      const rawNumber = phoneButton.dataset.phone || "";
      if (!rawNumber) return;

      const cleaned = rawNumber.replace(/[^0-9]/g, "");

      openFoodCallModal(
        place.name || "Call Restaurant",
        cleaned,
        "Would you like to call this restaurant?"
      );
    });

    // Add to itinerary
    const addButton = item.querySelector(".list-item__add-link");
    addButton.addEventListener("click", (event) => {
      event.stopPropagation();
      handleAddToItinerary(place);
    });

    listContainer.appendChild(item);
  });
}


    // Category filters
    function applyCategoryFilters() {
      const buttons = document.querySelectorAll(".food-category-filter");

      buttons.forEach(btn => {
        btn.addEventListener("click", () => {
          buttons.forEach(b => b.classList.remove("active"));
          btn.classList.add("active");

          const label = btn.textContent.trim().toLowerCase();
          const map = {
            "all": "all",
            "fast foods": "fastfood",
            "indian": "indian",
            "halal": "halal",
            "dessert": "dessert"
          };

          currentCategory = map[label] || "fastfood";
          filterAndRender();
        });
      });
    }

    // Simple search filter by name within current category
function filterAndRender() {
  const query = (searchInput.value || "").toLowerCase();
  const filtered = allPlaces.filter(p =>
    (currentCategory === "all" || p.category === currentCategory) &&
    (!query || p.name.toLowerCase().includes(query))
  );
  renderPlaces(filtered);
}


    searchInput.addEventListener("input", filterAndRender);

    // Fetch JSON + init (with structure detection + better errors)
    Promise.all([
      fetch(PLACES_JSON_URL).then(resp => {
        if (!resp.ok) throw new Error("places.json HTTP " + resp.status);
        return resp.json();
      }),
      fetch(DISHES_JSON_URL).then(resp => {
        if (!resp.ok) throw new Error("dishes.json HTTP " + resp.status);
        return resp.json();
      }).catch(err => {
        console.error("Failed to load dishes.json:", err);
        return {}; // fallback
      }),
      fetch(REVIEWS_JSON_URL).then(resp => {
        if (!resp.ok) throw new Error("reviews.json HTTP " + resp.status);
        return resp.json();
      }).catch(err => {
        console.error("Failed to load reviews.json:", err);
        return {}; // fallback
      })
    ])
      .then(([placesJson, dishesJson, reviewsJson]) => {
        console.log("placesJson:", placesJson);
        console.log("dishesJson:", dishesJson);
        console.log("reviewsJson:", reviewsJson);

        // Places
        allPlaces = placesJson.places || [];
        console.log("Loaded places:", allPlaces.length);

        // Dishes: handle BOTH possible formats
        const rawDishes = dishesJson || {};
        if (rawDishes.dishesByPlace) {
          dishesByPlace = rawDishes.dishesByPlace;
        } else if (Array.isArray(rawDishes.places)) {
          dishesByPlace = {};
          rawDishes.places.forEach(p => {
            if (p.name && Array.isArray(p.dishes)) {
              dishesByPlace[p.name] = p.dishes;
            }
          });
        } else {
          dishesByPlace = {};
          console.warn("Unknown dishes.json structure:", rawDishes);
        }

        // Reviews: handle BOTH possible formats
        const rawReviews = reviewsJson || {};
        if (rawReviews.reviewsByPlace) {
          reviewsByPlace = rawReviews.reviewsByPlace;
        } else if (Array.isArray(rawReviews.places)) {
          reviewsByPlace = {};
          rawReviews.places.forEach(p => {
            if (p.name && Array.isArray(p.reviews)) {
              reviewsByPlace[p.name] = p.reviews;
            }
          });
        } else {
          reviewsByPlace = {};
          console.warn("Unknown reviews.json structure:", rawReviews);
        }

        console.log("dishesByPlace keys:", Object.keys(dishesByPlace));
        console.log("reviewsByPlace keys:", Object.keys(reviewsByPlace));

        // initial list = fast food
// initial list = fast food
        currentCategory = "all"; // start on All
        const defaultList = allPlaces; // show everything
        renderPlaces(defaultList);
        applyCategoryFilters();


      })
      .catch(err => {
        console.error("Error loading JSON:", err);
        listContainer.innerHTML = "<p>Could not load places.</p>";
      });

      // =====================================================
//   FOOD PAGE ‚Äî CALL MODAL (isolated from global modal)
// =====================================================

let currentFoodCallNumber = "";

// Open the modal
function openFoodCallModal(title, number, description) {
  document.getElementById("foodModalTitle").textContent = title;
  document.getElementById("foodModalDescription").textContent = description;
  document.getElementById("foodModalNumberDisplay").textContent = number;

  currentFoodCallNumber = number;

  document.getElementById("foodCallModal").style.display = "flex";
}

// Close modal
function closeFoodCallModal() {
  document.getElementById("foodCallModal").style.display = "none";
}

// Confirm call
const foodConfirmCallBtn = document.getElementById("foodConfirmCallBtn");
if (foodConfirmCallBtn) {
  foodConfirmCallBtn.addEventListener("click", () => {
    if (!currentFoodCallNumber) return;
    window.location.href = `tel:${currentFoodCallNumber}`;
  });
}
// =====================================================
//   FOOD PAGE ‚Äî FAVORITE ALREADY ADDED MODAL
// =====================================================

let currentFavoritePlaceName = "";

function openFoodFavoriteModal(placeName) {
  currentFavoritePlaceName = placeName || "This place";

  const titleEl = document.getElementById("foodFavoriteTitle");
  const descEl  = document.getElementById("foodFavoriteDescription");
  const modal   = document.getElementById("foodFavoriteModal");

  if (titleEl) {
    titleEl.textContent = "Already in Favorites";
  }
  if (descEl) {
    descEl.textContent = `${currentFavoritePlaceName} is already in your favorites list.`;
  }
  if (modal) {
    modal.style.display = "flex";
  }
}

function closeFoodFavoriteModal() {
  const modal = document.getElementById("foodFavoriteModal");
  if (modal) {
    modal.style.display = "none";
  }
}


// =====================================================
//   FOOD PAGE ‚Äî ADD TO ITINERARY MODAL
// =====================================================

let currentFoodItineraryPlace = null;

function openFoodItineraryModal(place) {
  currentFoodItineraryPlace = place;

  // Set title text
  const titleEl = document.getElementById("foodItineraryTitle");
  if (titleEl) {
    titleEl.textContent = place.name || "Add to itinerary";
  }

  // Optional: tweak description
  const descEl = document.getElementById("foodItineraryDescription");
  if (descEl) {
    descEl.textContent = "Choose a date, time, and optional details for this restaurant.";
  }

  // Prefill fields with something reasonable
  const dateInput = document.getElementById("foodItineraryDate");
  const timeInput = document.getElementById("foodItineraryTime");
  const detailsInput = document.getElementById("foodItineraryDetails");

  if (dateInput) {
    // default to some date (or leave blank if you prefer)
    dateInput.value = "2026-07-14";
  }
  if (timeInput) {
    timeInput.value = "18:00";
  }
  if (detailsInput) {
    detailsInput.value = "";
  }

  const modal = document.getElementById("foodItineraryModal");
  if (modal) {
    modal.style.display = "flex";
  }
}

function closeFoodItineraryModal() {
  const modal = document.getElementById("foodItineraryModal");
  if (modal) {
    modal.style.display = "none";
  }
}


// Confirm button: actually add to localStorage
const foodConfirmItineraryBtn = document.getElementById("foodConfirmItineraryBtn");
if (foodConfirmItineraryBtn) {
  foodConfirmItineraryBtn.addEventListener("click", () => {
    if (!currentFoodItineraryPlace) return;

    const dateInput = document.getElementById("foodItineraryDate");
    const timeInput = document.getElementById("foodItineraryTime");
    const detailsInput = document.getElementById("foodItineraryDetails");

    const date = dateInput ? dateInput.value : "";
    if (!date) {
      alert("Please choose a date.");
      return;
    }

    const time = timeInput ? (timeInput.value || "") : "";
    const detailsRaw = detailsInput ? (detailsInput.value || "") : "";

    const FOOD_PLACEHOLDER_IMAGE = "../images/foods-image-18.png";

    const event = {
      date: date,
      time: time,
      title: currentFoodItineraryPlace.name,
      details: detailsRaw || (time ? time + " - TBD" : ""),
      address: currentFoodItineraryPlace.address || "",
      image: FOOD_PLACEHOLDER_IMAGE
    };

    const key = "userItineraryEvents";
    const existing = JSON.parse(localStorage.getItem(key) || "[]");
    existing.push(event);
    localStorage.setItem(key, JSON.stringify(existing));

    alert(`${currentFoodItineraryPlace.name} was added to your itinerary on ${date}.`);
    closeFoodItineraryModal();
  });
}

  </script>
</body>
</html>

